title: Dad Status
views:
  - title: Overview
    path: overview
    icon: mdi:home-heart
    cards:
      # ‚îÄ‚îÄ Status Header ‚îÄ‚îÄ
      - type: markdown
        content: |
          # Dad Status
          ---
          {% set last_activity = states('input_datetime.dad_last_activity') %}
          ### Last Activity: {{ last_activity | as_timestamp | timestamp_custom('%A at %I:%M %p') if last_activity not in ['unknown', 'unavailable', ''] else 'Unknown' }}

      # ‚îÄ‚îÄ Cloud Offline Warning (only shows when offline) ‚îÄ‚îÄ
      - type: conditional
        conditions:
          - entity: input_boolean.xiaomi_cloud_available
            state: "off"
        card:
          type: markdown
          content: |
            ## ‚ö†Ô∏è Xiaomi Cloud Offline
            Presence sensors not updating. **Activity alerts are paused.**

            | Sensor | Last Update | Current State |
            |--------|-------------|---------------|
            | üõèÔ∏è Bedroom | {{ states('sensor.bedroom_sensor_age') }} | {{ states('sensor.xiaomi_03_85df_occupancy_sensor') }} |
            | üöø Shower Room | {{ states('sensor.shower_room_sensor_age') }} | {{ states('sensor.xiaomi_03_b987_occupancy_sensor') }} |

            Camera motion detection is still working.

      # ‚îÄ‚îÄ Room Status ‚îÄ‚îÄ
      - type: markdown
        title: Room Status
        content: |
          {% set bedroom_state = states('sensor.xiaomi_03_85df_occupancy_sensor') %}
          {% set shower_state = states('sensor.xiaomi_03_b987_occupancy_sensor') %}
          {% set bedroom_age = states('sensor.bedroom_sensor_age') %}
          {% set shower_age = states('sensor.shower_room_sensor_age') %}
          {% set bedroom_stale_val = states('sensor.bedroom_sensor_stale') %}
          {% set shower_stale_val = states('sensor.shower_room_sensor_stale') %}
          {% set bedroom_stale = bedroom_stale_val in ['True', 'true', 'unknown', 'unavailable'] %}
          {% set shower_stale = shower_stale_val in ['True', 'true', 'unknown', 'unavailable'] %}
          {% set living_motion = states('binary_sensor.gramps_living_room_motion') %}
          {% set conservatory_motion = states('binary_sensor.gramps_conservatory_motion') %}

          | Room | Status | Last Update |
          |------|--------|-------------|
          | üõèÔ∏è Bedroom | {{ 'Presence' if 'has' in bedroom_state|lower else ('?' if bedroom_state in ['unknown','unavailable'] else 'Empty') }}{% if bedroom_stale %} ‚ö†Ô∏è{% endif %} | {{ bedroom_age if bedroom_age not in ['unknown','unavailable'] else 'No data' }}{% if bedroom_stale and bedroom_age not in ['unknown','unavailable'] %} **STALE**{% endif %} |
          | üöø Shower Room | {{ 'Presence' if 'has' in shower_state|lower else ('?' if shower_state in ['unknown','unavailable'] else 'Empty') }}{% if shower_stale %} ‚ö†Ô∏è{% endif %} | {{ shower_age if shower_age not in ['unknown','unavailable'] else 'No data' }}{% if shower_stale and shower_age not in ['unknown','unavailable'] %} **STALE**{% endif %} |
          | üì∫ Living Room | {{ 'Motion' if living_motion == 'on' else ('?' if living_motion in ['unknown','unavailable'] else 'Empty') }} | Camera |
          | üåø Conservatory | {{ 'Motion' if conservatory_motion == 'on' else ('?' if conservatory_motion in ['unknown','unavailable'] else 'Empty') }} | Camera |

          {% if bedroom_stale or shower_stale %}
          ---
          ‚ö†Ô∏è **Warning:** One or more Xiaomi sensors have stale data. The status shown may not be current.
          {% endif %}

      # ‚îÄ‚îÄ Sleep Pattern ‚îÄ‚îÄ
      - type: horizontal-stack
        cards:
          - type: entity
            entity: input_datetime.dad_bed_time
            name: Bed Time
            icon: mdi:bed-clock
          - type: entity
            entity: input_datetime.dad_wake_time
            name: Wake Time
            icon: mdi:weather-sunset-up
          - type: entity
            entity: input_datetime.dad_avg_wake_time
            name: Avg Wake
            icon: mdi:chart-line

      # ‚îÄ‚îÄ Camera Feeds ‚îÄ‚îÄ
      - type: horizontal-stack
        cards:
          - type: picture-glance
            title: Living Room
            camera_image: camera.gramps_living_room_fluent
            camera_view: live
            entities: []
          - type: picture-glance
            title: Conservatory
            camera_image: camera.gramps_conservatory_fluent
            camera_view: live
            entities: []

      # ‚îÄ‚îÄ Grafana Charts ‚îÄ‚îÄ
      # NOTE: Lovelace YAML does NOT support !secret - URLs must be inline
      # Replace YOUR_IP with your Grafana host (e.g. Tailscale IP or localhost)
      - type: iframe
        title: Today vs Normal Pattern
        url: http://YOUR_IP:3000/d-solo/dad-presence/dad-activity-patterns?orgId=1&panelId=1&kiosk&theme=dark
        aspect_ratio: 50%

      - type: iframe
        title: Activity by Room (7 Days)
        url: http://YOUR_IP:3000/d-solo/dad-presence/dad-activity-patterns?orgId=1&panelId=2&kiosk&theme=dark
        aspect_ratio: 50%

      - type: iframe
        title: Wake and Sleep Times
        url: http://YOUR_IP:3000/d-solo/dad-presence/dad-activity-patterns?orgId=1&panelId=3&kiosk&theme=dark
        aspect_ratio: 50%

      # ‚îÄ‚îÄ Batteries & Monitoring ‚îÄ‚îÄ
      - type: horizontal-stack
        cards:
          - type: entities
            title: Sensor Batteries
            show_header_toggle: false
            entities:
              - entity: sensor.xiaomi_03_85df_battery_level
                name: Bedroom Sensor
                icon: mdi:battery
              - entity: sensor.xiaomi_03_b987_battery_level
                name: Shower Room Sensor
                icon: mdi:battery
          - type: entities
            title: Monitoring Settings
            show_header_toggle: false
            entities:
              - entity: input_boolean.dad_monitoring_enabled
                name: Monitoring Enabled
                icon: mdi:shield-home
              - entity: input_number.daytime_alert_hours
                name: Daytime Alert Threshold
              - entity: input_number.nighttime_alert_hours
                name: Nighttime Alert Threshold

      # ‚îÄ‚îÄ System Health ‚îÄ‚îÄ
      - type: entities
        title: System Health
        show_header_toggle: false
        entities:
          - entity: input_boolean.xiaomi_cloud_available
            name: Xiaomi Cloud
            icon: mdi:cloud-check
          - entity: sensor.cpu_temperature
            name: CPU Temperature
            icon: mdi:thermometer
          - entity: sensor.disk_usage_percent
            name: Disk Usage
            icon: mdi:harddisk
          - entity: sensor.system_uptime
            name: Uptime
            icon: mdi:clock-outline
          - entity: sensor.deepgram_balance
            name: Deepgram Credit
            icon: mdi:credit-card
